<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Paulo - Gest√£o e Produ√ß√£o</title>
    <style>
        :root { --primary: #1a73e8; --success: #28a745; --warning: #f39c12; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 15px; }
        
        /* Estilo do Formul√°rio (S√≥ aparece na Gest√£o) */
        #form-gestao { background: #eef2f7; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #d1d9e6; }
        label { font-weight: bold; font-size: 13px; display: block; margin-top: 8px; }
        input, select { width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .btn-enviar { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; margin-top: 15px; cursor: pointer; }

        /* Estilo dos Cards */
        .card { background: white; border-left: 8px solid var(--primary); padding: 15px; margin-top: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: relative; }
        .card.pronto { border-left-color: var(--success); background: #f0fff4; }
        .cliente { font-size: 1.1rem; font-weight: bold; color: var(--primary); }
        .info { font-size: 0.95rem; margin: 5px 0; color: #444; }
        .data { font-size: 0.85rem; color: #d93025; font-weight: bold; }
        
        /* Bot√µes Din√¢micos */
        .btn-acao { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-pronto { background: var(--warning); color: white; }
        .btn-entregar { background: var(--success); color: white; }
        .btn-del { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #ccc; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="titulo-pagina">Painel de Gest√£o</h2>

    <div id="form-gestao">
        <label>üë§ Cliente:</label>
        <input type="text" id="cli" placeholder="Nome do cliente">
        <label>üìÖ Data de Envio:</label>
        <input type="datetime-local" id="dat">
        <label>üëï Produto / Cor / Estampa:</label>
        <input type="text" id="det" placeholder="Ex: Camiseta G, Azul, Logo Peito">
        <label>üí∞ Pagamento:</label>
        <select id="pag">
            <option value="PENDENTE">Pendente</option>
            <option value="METADE">50% Pago</option>
            <option value="TOTAL">Totalmente Pago</option>
        </select>
        <button class="btn-enviar" onclick="cadastrar()">LAN√áAR PARA PRODU√á√ÉO</button>
    </div>

    <div id="lista">Carregando pedidos...</div>
</div>

<script>
    // ‚ö†Ô∏è COLOQUE SUA URL DO GOOGLE ABAIXO
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxptJfRSBxTmxJHyxFulO2zYWnrLAaZxd-U00VKITcp21rYTuExf7KYSOM05AR8qHoaBA/exec";

    // Detectar se √© Produ√ß√£o ou Gest√£o pelo link
    const params = new URLSearchParams(window.location.search);
    const eProducao = params.has('producao');

    if (eProducao) {
        document.getElementById('form-gestao').style.display = 'none';
        document.getElementById('titulo-pagina').innerText = "Fila de Produ√ß√£o üõ†Ô∏è";
    }

    async function listar() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            const listaDiv = document.getElementById('lista');
            listaDiv.innerHTML = '';

            data.reverse().forEach(p => {
                const concluido = p.status === "CONCLU√çDO";
                
                // Na tela da produ√ß√£o, N√ÉO mostramos o que j√° est√° pronto
                if (eProducao && concluido) return;

                const div = document.createElement('div');
                div.className = `card ${concluido ? 'pronto' : ''}`;
                
                const dataF = new Date(p.dataEnvio).toLocaleString('pt-BR', {day:'2-digit', month:'2-digit', hour:'2-digit', minute:'2-digit'});

                div.innerHTML = `
                    <button class="btn-del" onclick="deletar('${p.id}')">X</button>
                    <div class="cliente">üë§ ${p.cliente}</div>
                    <div class="data">üìÖ Envio: ${dataF}</div>
                    <div class="info"><strong>Detalhes:</strong> ${p.produto}</div>
                    <div class="info">üí∞ <strong>Status:</strong> ${p.quitado}</div>
                    
                    ${!concluido ? 
                        `<button class="btn-acao btn-pronto" onclick="marcarPronto('${p.id}')">MARCAR COMO PRONTO</button>` : 
                        `<button class="btn-acao btn-entregar" onclick="deletar('${p.id}')">üì¶ ENTREGAR / SUMIR DA LISTA</button>`
                    }
                `;
                listaDiv.appendChild(div);
            });
        } catch (e) { console.log("Erro"); }
    }

    async function cadastrar() {
        const cli = document.getElementById('cli').value;
        const dat = document.getElementById('dat').value;
        const det = document.getElementById('det').value;
        const pag = document.getElementById('pag').value;

        if(!cli || !det) return alert("Preencha o cliente e produto!");

        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ action: "add", id: Date.now(), cliente: cli, dataEnvio: dat, produto: det, quitado: pag })
        });
        
        document.getElementById('cli').value = '';
        document.getElementById('det').value = '';
        listar();
    }

    async function marcarPronto(id) {
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "done", id: id }) });
        listar();
    }

    async function deletar(id) {
        if(confirm("Confirmar a√ß√£o?")) {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "delete", id: id }) });
            listar();
        }
    }

    setInterval(listar, 10000);
    listar();
</script>

</body>
</html>
